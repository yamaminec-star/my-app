<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    
    <!-- ビューポート設定スクリプト（即時実行） -->
    <script src="viewport.js"></script>
    
    <title>micedraw-JUS4U-</title>
    
    <!-- Google Fonts Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <!-- スタイルシート -->
    <link rel="stylesheet" href="styles.css">
</head>
</head>
<body>
    <!-- シェブロンメニューバー -->
    <div id="menu-bar">
        <button class="chevron-button" id="open-face-btn" title="顔写真を開く">
            <span>face</span>
        </button>
        <button  class="chevron-button" id="top-mode-button" title="測定モード">
            <span>straighten</span>
        </button>
        <button class="chevron-button" id="open-frame-btn" title="フレーム選択">
            <span>eyeglasses</span>
        </button>
        <button class="chevron-button" id="texture-btn" title="テクスチャ選択">
            <span>texture</span>
        </button>
        <button class="chevron-button" id="color-window-btn" title="カラー設定">
            <span>palette</span>
        </button>
        
        <button class="chevron-button" id="export-text-btn" title="データをテキスト出力">
        <span>convert_to_text</span>
        </button>
        <button class="chevron-button" id="save-image-btn" title="画像を保存">
            <span>save</span>
        </button>
        <button class="chevron-button" id="info-window-btn" title="情報パネル"> 
            <!-- style="margin-left: auto;" -->
            <span>menu</span>
        </button>
        <button class="chevron-button menu-toggle" id="fullscreen-btn" title="全画面表示">
            <span>fullscreen</span>
        </button>
        <button class="chevron-button" id="reload-frame-btn" title="フレーム・テクスチャデータ更新">
            <span>refresh</span>
        </button>
       
        
        <button class="chevron-button menu-page-toggle" id="menu-page-toggle-btn" title="ページ切替" style="margin-left: auto;">
            <span id="menu-page-toggle-icon">chevron_right</span>
        </button>
    </div>

    <!-- 情報バー（PD + 製品名） -->
    <div id="info-bar">
        <div class="pd-display">
            PD: <input type="number" id="top-real-size" value="60" placeholder="60" 
                   style="width: 60px; padding: 0px 8px; border: 1px solid #fff; border-radius: 1px; font-size: 24px; font-weight: bold; text-align: center; background: rgba(255,255,255,0.2); color: white;">
				    <span style="font-size: 17px">㎜</span>
        </div>
        <div class="product-name" id="product-name-display">micedraw</div>
    </div>

    <!-- メインコンテナ -->
    <div id="main-container">
        <!-- キャンバスエリア -->
        <div id="canvas-container">
            <canvas id="main-canvas"></canvas>
            
        </div>
    </div>
            <!-- 表示されないように非表示設定にするのがポイント -->
            <svg style="display:none;">
            <filter id="noise">
            <!-- baseFrequencyの数値を上げると、ざらざらが細かくなります -->
            <feTurbulence baseFrequency="0.8" />
            </filter>
            </svg>

    <!-- 拡大鏡（フローティングウィンドウ形式） -->
            <div id="magnifier" class="floating-window magnifier">
                <div class="window-header">
                    <div class="window-drag-bar">
                        <div class="window-title">
                            <span class="icon">zoom_in</span>
                        </div>
                    </div>
                    <button class="close-btn" id="magnifier-reset" >
                            <span class="icon">refresh</span>
                        </button>
                        <button class="close-btn" id="magnifier-window-close" >
                            <span class="icon">close</span>
                        </button>
                            
                    </div>
                <div class="window-body magnifier-body">
                    <canvas id="magnifier-canvas"></canvas>
                    <div class="magnifier-crosshair-v"></div>
                    <div class="magnifier-crosshair-h"></div>
                </div>
            </div>

    <!-- フローティングカラーウィンドウ -->
    <div id="color-window" class="floating-window">
        <div class="window-header">
            <div class="window-drag-bar">
                <div class="window-title">
                    <span class="icon">palette</span>
                </div>
            </div>
            <button class="close-btn" id="color-window-close">
                <span class="icon">close</span>
            </button>
        </div>
        
        <div class="tab-header">
            <button class="tab-button active" id="tab-btn-black">
                <span class="icon">eyeglasses</span>
            </button>
            <button class="tab-button" id="tab-btn-white">
                <span class="icon">circle</span>
            </button>
        </div>

        <div class="window-body">
            <!-- 黒部分タブ -->
            <div class="tab-content active" id="tab-black">
                <div class="color-picker-area" id="black-picker">
                    <div class="color-picker-handle" id="black-handle"></div>
                </div>
                
                <div class="color-slider">
                    <div class="slider-track hue-track">
                        <div class="slider-handle" id="black-hue-handle"></div>
                    </div>
                </div>
                
                <div class="color-slider">
                    <div class="slider-track opacity-track">
                        <div class="slider-handle" id="black-opacity-handle"></div>
                    </div>
                </div>
                
                <div class="rgba-display">
                    <div class="rgba-item">
                        <div class="rgba-label">R</div>
                        <div class="rgba-value" id="black-r">0</div>
                    </div>
                    <div class="rgba-item">
                        <div class="rgba-label">G</div>
                        <div class="rgba-value" id="black-g">0</div>
                    </div>
                    <div class="rgba-item">
                        <div class="rgba-label">B</div>
                        <div class="rgba-value" id="black-b">0</div>
                    </div>
                    <div class="rgba-item">
                        <div class="rgba-label">A</div>
                        <div class="rgba-value" id="black-a">100</div>
                    </div>
                </div>
            </div>

            <!-- 白部分タブ -->
            <div class="tab-content" id="tab-white">
                <div class="color-picker-area" id="white-picker">
                    <div class="color-picker-handle" id="white-handle"></div>
                </div>
                
                <div class="color-slider">
                    <div class="slider-track hue-track">
                        <div class="slider-handle" id="white-hue-handle"></div>
                    </div>
                </div>
                
                <div class="color-slider">
                    <div class="slider-track opacity-track">
                        <div class="slider-handle" id="white-opacity-handle"></div>
                    </div>
                </div>
                
                <div class="rgba-display">
                    <div class="rgba-item">
                        <div class="rgba-label">R</div>
                        <div class="rgba-value" id="white-r">255</div>
                    </div>
                    <div class="rgba-item">
                        <div class="rgba-label">G</div>
                        <div class="rgba-value" id="white-g">255</div>
                    </div>
                    <div class="rgba-item">
                        <div class="rgba-label">B</div>
                        <div class="rgba-value" id="white-b">255</div>
                    </div>
                    <div class="rgba-item">
                        <div class="rgba-label">A</div>
                        <div class="rgba-value" id="white-a">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 情報ウィンドウ -->
    <div id="info-window" class="floating-window">
        <div class="window-header">
            <div class="window-drag-bar">
                <div class="window-title">
                    <span class="icon">info</span>
                </div>
            </div>
            <button class="close-btn" id="info-window-close">
                <span class="icon">close</span>
            </button>
        </div>
       <div class="window-body">
            <div id="info-window-content" class="info-container">
        
                <!-- 顔写真情報 -->
                <div class="info-section">
            <div class="info-title title-red">顔写真情報</div>
            <div class="info-item">
                ファイル: <span id="face-file-name-window">未選択</span>
            </div>
        </div>

        <!-- 比率計算 -->
        <div class="info-section">
            <div class="info-title">比率計算</div>
            <div class="info-item">
                測定ピクセル: <span id="pixel-distance-window">--px</span><br>
                実際の距離: <span id="real-distance-window">60</span>mm<br>
                比率 (px/mm): <span id="scale-ratio-window">--</span>
            </div>
        </div>

        <!-- フレーム情報 -->
        <div class="info-section">
            <div class="info-title">フレーム情報</div>
            <div class="info-item">
                ファイル: <span id="frame-file-name-window">未選択</span><br>
                実寸 (mm): <input type="number" id="frame-real-size-window" value="160" placeholder="160" class="info-input">
            </div>
        </div>

        <!-- テクスチャ情報 -->
        <div class="info-section">
            <div class="info-title">テクスチャ情報</div>
            <div class="info-item">
                ファイル: <span id="texture-file-name-window">未選択</span>
            </div>
        </div>

        <!-- カラー情報 -->
        <div class="info-section">
            <div class="info-title">カラー情報</div>
            <div class="info-item family-mono">
                黒部分: <span id="color-black-window">RGB(0, 0, 0) A:100</span><br>
                白部分: <span id="color-white-window">RGB(255, 255, 255) A:0</span>
            </div>
        </div>

        <!-- サイズ計算 -->
        <div class="info-section">
            <div class="info-title">サイズ計算</div>
            <div class="info-item highlight-orange">
                <div id="calc-160-window">? 160mm: --px</div>
            </div>
        </div>

        <!-- 測定情報 -->
        <div class="info-section">
            <div class="info-title">測定点</div>
            <div id="measurement-points-window" class="info-item">
                測定点なし
            </div>
        </div>

         <!-- 備考 -->
        <div class="info-section">
            <div class="info-title">備考</div>
            <div class="info-item">
                <textarea id="notes-textarea" class="notes-textarea" 
                    maxlength="32" rows="2" placeholder="備考を入力..."></textarea>
            </div>
        </div>

        <!-- 表示スケール設定 -->
        <div class="info-section">
            <div class="info-title">表示スケール</div>
            <div class="info-item">
                <div class="mb-8">
                    倍率: <input type="number" id="scale-input" min="0.1" max="3.0" step="0.1" value="1.0" class="info-input">
                </div>
                <div class="scale-link-container">
                    <a id="scale-link" href="" target="_blank">リンクを生成中...</a>
                </div>
            </div>
        </div>
        </div>
        </div>
    </div>

    <!-- テクスチャ選択ウィンドウ -->
    <div id="texture-window" class="floating-window">
        <div class="window-header">
            <div class="window-drag-bar">
                <div class="window-title">
                    <span class="icon">texture</span>
                    生地選択
                </div>
            </div>
            <button class="close-btn" id="texture-window-close">
                <span class="icon">close</span>
            </button>
        </div>
        <div class="window-body">
            <div class="texture-grid" id="texture-grid">
                <div class="texture-item" onclick="app.selectTexture('none')">
                     <div class="texture-preview" style="background: #272727; color: #ffffff; display: flex; align-items: center; justify-content: center;"><span class="texture-item-icon">palette</span></div>
                    <div class="texture-item-name">カラー設定を使用</div>
                </div>
                <div class="loading">テクスチャ一覧を読み込み中...</div>
            </div>
        </div>
    </div>

    <!-- フレーム選択モーダル -->
    <div id="frame-selector-modal" class="modal-overlay" style="display: none;">
        <div class="modal-window">
            <div class="modal-header">
                 <h3>フレーム選択</h3>
                <button class="filter-toggle-btn" id="filter-toggle-btn" onclick="app.toggleFrameFilter()">
                    <span class="icon">expand_more</span>
                </button>
                <button class="modal-close-btn" onclick="app.closeFrameSelector()">
                    <span class="icon">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="frame-filters" id="frame-filters">
                    <div class="column-selector">
                        <span>表示：</span>
                        <button onclick="app.setGridColumns(1)">1</button>
                        <button onclick="app.setGridColumns(2)">2</button>
                        <button onclick="app.setGridColumns(3)">3</button>
                        <button onclick="app.setGridColumns(4)">4</button>
                        <button onclick="app.setGridColumns(5)" class="active">5</button>
                    </div>
                    <div class="filter-group">
                        <label>品名:</label>
                        <div class="filter-checkboxes" id="series-filters"></div>
                    </div>
                    <div class="filter-group">
                        <div class="range-row">
                            <div class="range-item">
                                <label>PD:</label>
                                <div class="range-slider-container">
                                    <div class="range-slider">
                                        <input type="range" id="pd-min" class="range-min" min="58" max="80" value="58" step="1">
                                        <input type="range" id="pd-max" class="range-max" min="58" max="80" value="80" step="1">
                                    </div>
                                    <div class="range-values" id="pd-values">58 - 80</div>
                                </div>
                            </div>
                            <div class="range-item">
                                <label>OW:</label>
                                <div class="range-slider-container">
                                    <div class="range-slider">
                                        <input type="range" id="ow-min" class="range-min" min="124" max="160" value="124" step="1">
                                        <input type="range" id="ow-max" class="range-max" min="124" max="160" value="160" step="1">
                                    </div>
                                    <div class="range-values" id="ow-values">124 - 160</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="filter-buttons">
                        <button onclick="app.clearFilterSelection()">クリア</button>
                        <button onclick="app.updateFrameFilters()">適用</button>
                        <button onclick="app.toggleFrameFilter()">OK</button>
                    </div>
                </div>
                <div class="frame-grid" id="frame-grid">
                    <div class="loading">フレーム一覧を読み込み中...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ステータスバー -->
    <div id="status-bar">準備完了</div>

    <!-- 隠しファイル入力 -->
    <input type="file" id="face-input" accept="image/*" style="display:none">
    <input type="file" id="frame-input" accept="image/*" style="display:none">

    
    <!-- アプリケーションスクリプト（ES6モジュール） -->
    <script type="module" src="main.js"></script>
</body>
</html>
